<html>
	<head>
		<title>Eater</title>
	</head>
	<script language="Javascript" src="../../Framework/jsGFwk.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwk2dFastAnimation.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkContainer.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkIO.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkCollisions.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkRM.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkSprites.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkFonts.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkScenes.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkPath.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkTimers.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkJukebox.js"></script>
    <script language="Javascript" src="../../Framework/jsGFwkCamera.js"></script>
    <script language="Javascript" src="../../Framework/jsGFwkWebStorage.js"></script>
    <script language="Javascript" src="../../Framework/jsGFwkGamepad.js"></script>
	
    <script language="Javascript" src="scripts/glfx.js"></script>
    
    <script language="Javascript" src="scripts/player.js"></script>
    <script language="Javascript" src="scripts/foots.js"></script>
    <script language="Javascript" src="scripts/hazards.js"></script>
    <script language="Javascript" src="scripts/foreground.js"></script>
    <script language="Javascript" src="scripts/levelController.js"></script>
    <script language="Javascript" src="scripts/timing.js"></script>
    <script language="Javascript" src="scripts/levels.js"></script>
    <script language="Javascript" src="scripts/hud.js"></script>
    
	<body style="border:0px; margin:0px; padding:0px; background-color: black;">
        <canvas width="640" height="480" id="canvas"></canvas>
	</body>
</html>
<script>
    var gameConst = {
        width: 640,
        height: 480,
        spriteWidth: 19,
        spriteHeight: 28,
        maxPlayerXReach: function() { return this.width - this.spriteWidth },
        maxPlayerYReach: function() { return this.height - this.spriteHeight },
        currentLevel: 0,
        fx: {
            glCanvas: null,
            glTexture: null
        }
    };
    
	jsGFwk.settings.canvas = "canvas";
	jsGFwk.settings.clearColor = "rgb(10, 10, 10)";
	jsGFwk.settings.frameRate = 1000 / 60;
	
	jsGFwk.include("FastAnimation");
	jsGFwk.include("Container");
	jsGFwk.include("IO");
	jsGFwk.include("Collisions");
	jsGFwk.include("ResourceManager");
	jsGFwk.include("Sprites");
	jsGFwk.include("Fonts");
	jsGFwk.include("Scenes");
	jsGFwk.include("Path");
    jsGFwk.include("Camera");
    jsGFwk.include("Storage");
    jsGFwk.include("Gamepad");
	
	jsGFwk.Fonts.createFont({ name: 'pixelated', source: 'fonts/pixelated.ttf' });
    jsGFwk.Fonts.createFont({ name: 'oxi', source: 'fonts/OXYGENE1.ttf' });
    jsGFwk.Fonts.createFont({ name: 'zxBold', source: 'fonts/zxBold.ttf' });
    jsGFwk.Fonts.createFont({ name: 'gooddog', source: 'fonts/GoodDog.otf' });
    jsGFwk.Fonts.createFont({ name: 'fff', source: 'fonts/FFF_Tusj.ttf' });
    
    var laserSound = {};
		laserSound[jsGFwk.ResourceManager.sounds.format.mp3] = { source: "fx/laser.mp3" };
        laserSound[jsGFwk.ResourceManager.sounds.format.ogg] = { source: "fx/laser.ogg" };
	jsGFwk.ResourceManager.addSound({ name: "eat", sources: laserSound});
    
    //Load game images
    jsGFwk.ResourceManager.addGraphic({ name: "main", source: "images/eater.png" });
    jsGFwk.ResourceManager.addGraphic({ name: "scanLines", source: "images/scanlines.png" });
    
    var footsContainer = jsGFwk.Container.createContainer("footsCloner", Foots, true);
    var hazardsContainer = jsGFwk.Container.createContainer("hazardsCloner", Hazards, true);
    
    jsGFwk.Scenes.create({name: "game", 
        gameObjects: [Player, LevelController, footsContainer,
                      hazardsContainer, Foreground, Timing] });
    
    jsGFwk.Scenes.create({name: "hud", 
        gameObjects: [Hud] });
    
    var eatJuke = {};
    
    jsGFwk.ResourceManager.onResourcesLoadedCompleted = function() {
        eatJuke = new jsGFwk.Jukebox({volume: 0.3, channels: 5, source: jsGFwk.ResourceManager.sounds.eat });

        jsGFwk.Sprites.createSpriteCollection("eater",
            jsGFwk.ResourceManager.graphics.main.image, 
            [{left: 92, top: 262, width: 19, height: 28}, 
             {left: 122, top: 262, width: 19, height: 28}]);
        jsGFwk.Sprites.eater.loop(true);
        
        jsGFwk.Sprites.createSpriteCollection("yeti",
            jsGFwk.ResourceManager.graphics.main.image, 
            [{left: 279, top: 260, width: 23, height: 30}, 
             {left: 307, top: 260, width: 23, height: 30}]);
        jsGFwk.Sprites.yeti.loop(true);
        
        jsGFwk.Sprites.createSprite({
            id: "foots", graphic: jsGFwk.ResourceManager.graphics.main.image,
            left: 156, top: 276, width: 13, height: 12
        });
        
        jsGFwk.Sprites.createSprite({
            id: "traps", graphic: jsGFwk.ResourceManager.graphics.main.image,
            left: 174, top: 276, width: 16, height: 12
        });
        
        jsGFwk.Scenes.scenes.game.enable();
        
        //WebGL module
        var source = jsGFwk.FastAnimation._canvas;
        gameConst.fx.glCanvas = fx.canvas();
        gameConst.fx.glTexture = gameConst.fx.glCanvas.texture(source);
        source.parentNode.insertBefore(gameConst.fx.glCanvas, source);
        source.style.display = 'none';
    };
    
    jsGFwk.start();
</script>