<html>
	<head>
		<title>Trenches on Fire</title>
	</head>
	<script language="Javascript" src="../../Framework/jsGFwk.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwk2dFastAnimation.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkContainer.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkIO.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkCollisions.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkRM.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkSprites.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkFonts.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkScenes.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkPath.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkTimers.js"></script>
	<script language="Javascript" src="../../Framework/jsGFwkJukebox.js"></script>
	
	<script language="Javascript" src="scripts/globals.js"></script>
    <script language="Javascript" src="scripts/gameBackground.js"></script>
    <script language="Javascript" src="scripts/hud.js"></script>
	<script language="Javascript" src="scripts/trenchController.js"></script>
	<script language="Javascript" src="scripts/trench.js"></script>
	
	<body style="border:0px; margin:0px; padding:0px; background-color: white;">
		<canvas width="640" height="480" id="canvas"></canvas>
	</body>
    <img src="images/face.png" id="loadingFace" style="display:none;" onload="startGame();">
</html>
<script>
	
    var loadingImg = document.getElementById('loadingFace');
    
	jsGFwk.settings.canvas = "canvas";
	jsGFwk.settings.clearColor = "rgb(50, 50, 50)";
	jsGFwk.settings.frameRate = 1000 / 60;
	
	jsGFwk.include("FastAnimation");
	jsGFwk.include("Container");
	jsGFwk.include("IO");
	jsGFwk.include("Collisions");
	jsGFwk.include("ResourceManager");
	jsGFwk.include("Sprites");
	jsGFwk.include("Fonts");
	jsGFwk.include("Scenes");
	jsGFwk.include("Path");
	
	jsGFwk.Fonts.createFont({ name: 'zxBold', source: 'fonts/zxBold.ttf' });

    //Create new objects
    var leftTrenchController = new trenchController({
        side: global.sides.left,
        x: 126, //global.trenchConfig.trenchDefinition.width,
        showFire: true,
        trenchDirection: global.trenchDirections.right
    });
    leftTrenchController.id = "leftTrenchController";
    
    var rightTrenchController = new trenchController({
        side: global.sides.right,
        x: 600,
        showFire: true,
        trenchDirection: global.trenchDirections.left
    });
    rightTrenchController.id = "rightTrenchController";
    
    var trenchContainer = jsGFwk.Container.createContainer("trenchCloner", new trench(), true);
    var mainHud = new hud();
    var gBackground = new gameBackground();
    
    jsGFwk.ResourceManager.addGraphic({ name: "face", source: "images/face.png" });
    jsGFwk.ResourceManager.addGraphic({ name: "mainSprite", source: "images/mainSprites.png" });
    jsGFwk.ResourceManager.addGraphic({ name: "hudSprite", source: "images/hud.png" });
    
	jsGFwk.createObject({
		id: "progress",
		visible: true,
		barWidth: 0,
        loaded: 0,
		init: function() {
			jsGFwk.ResourceManager.onResourcesLoadedCompleted = function() {
		
                jsGFwk.Sprites.createSprite({
                    id: "background", 
                    graphic: jsGFwk.ResourceManager.graphics.mainSprite.image, 
                    top: 189, 
                    left: 0, 
                    width: 640, 
                    height: 480
                });
                
                jsGFwk.Sprites.createSprite({
                    id: "cactusShadow", 
                    graphic: jsGFwk.ResourceManager.graphics.mainSprite.image, 
                    top: 0, 
                    left: 126, 
                    width: 51, 
                    height: 32
                });
                
                jsGFwk.Sprites.createSprite({
                    id: "cactus", 
                    graphic: jsGFwk.ResourceManager.graphics.mainSprite.image, 
                    top: 1, 
                    left: 178, 
                    width: 40, 
                    height: 57
                });
                
                jsGFwk.Sprites.createSpriteCollection("route", 
                    jsGFwk.ResourceManager.graphics.mainSprite.image, 
                    [{left: 0, top: 126, width: 63, height: 63},
                     {left: 0, top: 63, width: 63, height: 63},
                     {left: 63, top: 63, width: 63, height: 63},
                     {left: 664, top: 0, width: 63, height: 63},
                     {left: 727, top: 0, width: 63, height: 63},
                     {left: 475, top: 0, width: 63, height: 63}
                    ]);
                
                jsGFwk.Sprites.createSpriteCollection("hud", 
                    jsGFwk.ResourceManager.graphics.hudSprite.image, 
                    [{left: 293, top: 371, width: 32, height: 99},
                     {left: 350, top: 371, width: 58, height: 99},
                     {left: 419, top: 371, width: 63, height: 99},
                     {left: 491, top: 371, width: 85, height: 99},
                     {left: 608, top: 371, width: 32, height: 99}]);
                
				jsGFwk.Scenes.create({name: "hud", 
					gameObjects: [mainHud] });
			
				jsGFwk.Scenes.create({name: "game", 
					gameObjects: [gBackground, 
                                  leftTrenchController, 
                                  rightTrenchController, 
                                  trenchContainer] });
					
				jsGFwk.Scenes.scenes.hud.enable();
                //jsGFwk.Scenes.scenes.game.enable();
				jsGFwk._gameObjects.progress.destroy();
			};
		},
		update: function(delta) { 
            this.loaded = parseInt((jsGFwk.ResourceManager._totalLoadedResources * 100) / jsGFwk.ResourceManager._totalResources);
        },
		draw: function (context) { 
			context.save();
				context.fillStyle = "white";
                context.textAlign = "center";
				context.fillText("Charging up..." + this.loaded + "%" , 325, 290);
                context.drawImage(loadingImg, 295, 215);
			context.restore();
		}
	});
	
    function startGame() {
	   jsGFwk.start();
    }
</script>